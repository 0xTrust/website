<!DOCTYPE html>
<html lang="en-US" class="has-navbar-fixed-top">

<head>
    <meta name="generator" content="Hugo 0.52" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Write script to scrap house rent price and send to your phone | Tony Xu Blog</title>

     
      
    
    
    
    
    

  <meta name="author" content="Tony Xu">

 
    <meta property="og:title" content="Write script to scrap house rent price and send to your phone" />
<meta property="og:description" content="House rental is a critical thing if you are living in the silicon valley. I&rsquo;m planning to move to a new apartment, but the price changes often. I want to monitor the price and book it when it drops. In order to do that, I wrote a script to monitor the house rental price and push the result to my phone like below.
Get Started The apartment I&rsquo;m looking at is a professional rental apartment, to not disclose the place I will be living in, I&rsquo;m using another one for example." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2018/write-script-to-scrap-house-rental-price/" /><meta property="article:published_time" content="2018-07-28T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-07-28T00:00:00&#43;00:00"/><meta property="og:site_name" content="Tony Xu Blog" />
 
    



 
    
     
     
    
    
    <link rel="canonical" href="/posts/2018/write-script-to-scrap-house-rental-price/">   <link rel="shortcut icon" type="image/png" href="profile-pic.png">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> 
    <link rel="stylesheet" href="/css/bulma.css"> 
</head>


<body>
    <header> <nav class="navbar is-fixed-top">
  <div class="container">
      <div class="navbar-brand">
          <a class="navbar-item" href=/>
            <img src="/profile-pic.png" alt="Bulma logo">
          </a>
          <a class="navbar-item" href=/>
            Tony Xu Blog
          </a>
          <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>
        </div>
      
        <div class="navbar-menu" id="navMenu">
      
          
          
          <div class="navbar-end">
            
            <a class="navbar-item" target="blank" href="https://github.com/tonyxu-io">
              <span class="icon">
                <i class="fa fa-github"></i>
              </span>
            </a>
            
      
            
            <a class="navbar-item" target="blank" href="https://www.linkedin.com/in/tonyxu93">
              <span class="icon">
                <i class="fa fa-linkedin"></i>
              </span>
            </a>
            
            <div class="navbar-item">
              
              
              <a itemprop="url" class="navbar-item "
                href="/about"><span itemprop="name">About</span></a>
              
              <a itemprop="url" class="navbar-item "
                href="/friends/"><span itemprop="name">Friends</span></a>
              
              <a itemprop="url" class="navbar-item  is-active"
                href="/posts/"><span itemprop="name">Posts</span></a>
              
            </div>
          </div>
        </div>
  </div>
  
</nav>
 </header>
    <main>

<div class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-8 is-offset-2">
        <p class="title">Write script to scrap house rent price and send to your phone</p>
        <p class="text">
  
  <span>Sat, Jul 28, 2018</span>
  
</p>
        <hr />
        <div class="content">
          

<p>House rental is a critical thing if you are living in the silicon valley. I&rsquo;m planning to move to a new apartment, but the price changes often. I want to monitor the price and book it when it drops. In order to do that, I wrote a script to monitor the house rental price and push the result to my phone like below.</p>

<h2 id="get-started">Get Started</h2>

<p>The apartment I&rsquo;m looking at is a professional rental apartment, to not disclose the place I will be living in, I&rsquo;m using another one for example.</p>

<p>The official website of the apartment is:</p>

<p><a href="https://www.avaloncommunities.com/california/mountain-view-apartments/avalon-mountain-view/floor-plans">https://www.avaloncommunities.com/california/mountain-view-apartments/avalon-mountain-view/floor-plans</a></p>

<p>The pricing section:</p>

<p><img src="./2018_07_28_22_50_27.png" alt="" /></p>

<h2 id="analysis">Analysis</h2>

<p>To monitor the price, the script will need to:</p>

<ol>
<li>Get the price, size, move-in-date, and other interesting information<br /></li>
<li>Compose to a message and send to me(I personally use Telegram Bot, refer to:<a href="/posts/2018/use-telegram-and-flask-to-build-notification-server/">Use Telegram and Flask to build personal notification server</a>)<br />
<br /></li>
</ol>

<h2 id="implementation">Implementation</h2>

<p>Originally, I plan to use spider to scrap html text and extract information, however, I discovered that the websiste use public REST API as interface for front-end client. To make sure the API works without authentication/authorization, I copied the GET request to an anonymous window and it works fine. So this API can be used to get all information I need.</p>

<p>Chrome Inspector:</p>

<p><img src="./2018_07_28_23_02_23.png" alt="" /></p>

<p>After further research, I found that this API even support additional parameters to set minimum price, maximum price, and move-in date, etc.</p>

<p>Now it&rsquo;s time to implement, as I have a Flask app running on Google App Engine, I will be writing Python code to do the job. The job will be triggered by a HTTP request to the Flask app. You can use GitLab to make the HTTP call to the Flask app as introduced here <a href="/posts/2018/use-gitlab-ci-to-run-free-scheduled-jobs/">Use GitLab-CI to run free scheduled jobs</a></p>

<h2 id="code">Code</h2>

<h3 id="flask-app">Flask App</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#5c35cc;font-weight:bold">@app.route</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;/housing&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">methods</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;GET&#39;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">housing</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#000">houseResponse</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">json</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">loads</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">urlfetch</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fetch</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">url</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;https://api.avalonbay.com/json/reply/ApartmentSearch?communityCode=CA049&amp;min=2000&amp;max=3000&amp;desiredMoveInDate=2018-09-01T07:00:00.000Z&#39;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">content</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">availableFloorPlans</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">houseResponse</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;results&#34;</span><span style="color:#000;font-weight:bold">][</span><span style="color:#4e9a06">&#34;availableFloorPlanTypes&#34;</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">][</span><span style="color:#4e9a06">&#34;availableFloorPlans&#34;</span><span style="color:#000;font-weight:bold">]</span>
    <span style="color:#000">responseText</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;*House Quotes:*%0A&#34;</span>
    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">availableFloorPlan</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">availableFloorPlans</span><span style="color:#000;font-weight:bold">:</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">apartment</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">availableFloorPlan</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;finishPackages&#34;</span><span style="color:#000;font-weight:bold">][</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">][</span><span style="color:#4e9a06">&#34;apartments&#34;</span><span style="color:#000;font-weight:bold">]:</span>
            <span style="color:#000">responseText</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#4e9a06">&#34;Size:&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">apartment</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;apartmentSize&#34;</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; Price:&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">apartment</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;pricing&#34;</span><span style="color:#000;font-weight:bold">][</span><span style="color:#4e9a06">&#34;effectiveRent&#34;</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; Floor:&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">apartment</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;floor&#34;</span><span style="color:#000;font-weight:bold">])</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; Date:&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strftime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;%Y-%m-</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">time</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">localtime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">float</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">str</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">isdigit</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">apartment</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;pricing&#34;</span><span style="color:#000;font-weight:bold">][</span><span style="color:#4e9a06">&#34;availableDate&#34;</span><span style="color:#000;font-weight:bold">])))</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;%0A&#34;</span>
    <span style="color:#000">requestUrl</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">config</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">telegramWebHookURI</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;/sendMessage?parse_mode=Markdown&amp;chat_id=123456789&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;&amp;text=&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">responseText</span>
    <span style="color:#000">urlfetch</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fetch</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">url</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">requestUrl</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">content</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">responseText</span></code></pre></div>
<h3 id="gitlab-ci">GitLab-CI</h3>

<p>GitLab-CI Configuration (gitlab-ci.yml):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">test<span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>script<span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>-<span style="color:#f8f8f8;text-decoration:underline"> </span>bash<span style="color:#f8f8f8;text-decoration:underline"> </span>scripts/get_quotes.sh</code></pre></div>
<p>GitLab-CI Script (get_quotes.sh):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#8f5902;font-style:italic">#!/bin/sh
</span><span style="color:#8f5902;font-style:italic"></span>curl https://api.tonyxu.io/housing</code></pre></div>
<h2 id="demo">Demo</h2>

<p><img width="50%" style="min-width:300px" src="./2018_07_28_23_35_59.png"></p>

        </div>
      </div>
    </div>

  </div>
</div>
</main>
    <footer>
<footer class="footer">
  <div class="container">
    <div class="columns">
      <div class="column is-one-third">
          <div class="field">
              <div class="control has-icons-left">
                <div class="select is-rounded  is-small">
                  <select size="1" name="links" onchange="window.location.href=this.value;">
                    <option selected disabled>Language</option>
                    
                    <option value="/">English</option>
                    
                    <option value="/zh/">中文</option>
                    
                  </select>
                </div>
                <div class="icon is-small is-left">
                  <i class="fa fa-globe"></i>
                </div>
              </div>
            </div>
      </div>
      <div class="column is-one-third">
        <div class="content has-text-centered">
          <p>
            © 2019 Tony Xu
          </p>
        </div>
      </div>
      <div class="column is-one-third has-text-right">
        
      </div>
    </div>
  </div>
</footer>
</footer>

    <script async type="text/javascript" src="/js/bulma.js"></script>
</body>

</html>