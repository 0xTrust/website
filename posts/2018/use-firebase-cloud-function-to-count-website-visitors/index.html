<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Use Firebase Cloud Function to Count Website Visitors | Tony Xu Blog</title>
    <meta name="description" content="It&#39;s getting popular to use Firebase hosting to host static website, however, you might not know you can still have server-side code hosted in Firebase for your static website, and that is the Firebase Cloud Function. Once of the case you might want to use the Cloud Function is to write something to Firebase database, for example, a hit counter. In this topic, I&#39;ll show you how to use Firebase Cloud Function and Firebase Realtime Database to count website visitor.">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="alternate" type="application/rss+xml" href="https://tonyxu.io/rss.xml" title=" RSS Feed">
  <link rel="alternate" type="application/atom+xml" href="https://tonyxu.io/feed.atom" title=" Atom Feed">
  <link rel="alternate" type="application/json" href="https://tonyxu.io/feed.json" title=" JSON Feed">
    
    <link rel="preload" href="/assets/css/0.styles.9c760875.css" as="style"><link rel="preload" href="/assets/js/app.269ec5ce.js" as="script"><link rel="preload" href="/assets/js/12.5e9c564d.js" as="script"><link rel="preload" href="/assets/js/2.a93cbcc6.js" as="script"><link rel="preload" href="/assets/js/42.75a344de.js" as="script"><link rel="preload" href="/assets/js/13.0ba02817.js" as="script"><link rel="prefetch" href="/assets/js/10.e93c632b.js"><link rel="prefetch" href="/assets/js/11.f3e1b910.js"><link rel="prefetch" href="/assets/js/14.14cee905.js"><link rel="prefetch" href="/assets/js/15.026b2087.js"><link rel="prefetch" href="/assets/js/16.9aba6acb.js"><link rel="prefetch" href="/assets/js/17.86cf2ee6.js"><link rel="prefetch" href="/assets/js/18.a26e200a.js"><link rel="prefetch" href="/assets/js/19.becb87ef.js"><link rel="prefetch" href="/assets/js/20.03d76736.js"><link rel="prefetch" href="/assets/js/21.8082ca18.js"><link rel="prefetch" href="/assets/js/22.a7a1f43f.js"><link rel="prefetch" href="/assets/js/23.4c2acc0d.js"><link rel="prefetch" href="/assets/js/24.76480988.js"><link rel="prefetch" href="/assets/js/25.d4f46d75.js"><link rel="prefetch" href="/assets/js/26.1d25b651.js"><link rel="prefetch" href="/assets/js/27.4af385a5.js"><link rel="prefetch" href="/assets/js/28.fd254856.js"><link rel="prefetch" href="/assets/js/29.d4ec7683.js"><link rel="prefetch" href="/assets/js/3.35f5fbcf.js"><link rel="prefetch" href="/assets/js/30.03945b2e.js"><link rel="prefetch" href="/assets/js/31.fa069bcd.js"><link rel="prefetch" href="/assets/js/32.6f58ba21.js"><link rel="prefetch" href="/assets/js/33.2f3a49fd.js"><link rel="prefetch" href="/assets/js/34.7de30ca2.js"><link rel="prefetch" href="/assets/js/35.a59e3f9e.js"><link rel="prefetch" href="/assets/js/36.3dce9079.js"><link rel="prefetch" href="/assets/js/37.2dd7fbdc.js"><link rel="prefetch" href="/assets/js/38.02e6fa35.js"><link rel="prefetch" href="/assets/js/39.1a940c95.js"><link rel="prefetch" href="/assets/js/4.2da6a2a8.js"><link rel="prefetch" href="/assets/js/40.b8380f7f.js"><link rel="prefetch" href="/assets/js/41.21c4995c.js"><link rel="prefetch" href="/assets/js/43.8dedfcb3.js"><link rel="prefetch" href="/assets/js/44.de358bd2.js"><link rel="prefetch" href="/assets/js/45.fe57eda1.js"><link rel="prefetch" href="/assets/js/46.67a18af8.js"><link rel="prefetch" href="/assets/js/47.d48f3e95.js"><link rel="prefetch" href="/assets/js/48.7d80d913.js"><link rel="prefetch" href="/assets/js/49.3c0e7451.js"><link rel="prefetch" href="/assets/js/5.668c5277.js"><link rel="prefetch" href="/assets/js/50.c99e186e.js"><link rel="prefetch" href="/assets/js/51.53b8bcc3.js"><link rel="prefetch" href="/assets/js/52.5626a491.js"><link rel="prefetch" href="/assets/js/53.26c16782.js"><link rel="prefetch" href="/assets/js/54.83da082f.js"><link rel="prefetch" href="/assets/js/55.7b7ed42c.js"><link rel="prefetch" href="/assets/js/56.a094be53.js"><link rel="prefetch" href="/assets/js/57.ef99f0d6.js"><link rel="prefetch" href="/assets/js/58.f6f0298a.js"><link rel="prefetch" href="/assets/js/59.2032b166.js"><link rel="prefetch" href="/assets/js/6.b6484e19.js"><link rel="prefetch" href="/assets/js/60.b00d11d5.js"><link rel="prefetch" href="/assets/js/61.77f8bbf6.js"><link rel="prefetch" href="/assets/js/62.15093aa7.js"><link rel="prefetch" href="/assets/js/63.30f6545a.js"><link rel="prefetch" href="/assets/js/64.9eb5cfc5.js"><link rel="prefetch" href="/assets/js/65.4b539e17.js"><link rel="prefetch" href="/assets/js/66.cfa1dc61.js"><link rel="prefetch" href="/assets/js/67.efe52b3b.js"><link rel="prefetch" href="/assets/js/68.b2f3d3bd.js"><link rel="prefetch" href="/assets/js/7.f81cef96.js"><link rel="prefetch" href="/assets/js/8.2f8c0b11.js"><link rel="prefetch" href="/assets/js/9.26cb2aa2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9c760875.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tony Xu Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">Posts</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/friends/" class="nav-link">Friends</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Eng/中</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/posts/2018/use-firebase-cloud-function-to-count-website-visitors/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/posts/2018/use-firebase-cloud-function-to-count-website-visitors/" class="nav-link">中文</a></li></ul></div></div> <a href="https://github.com/tonyxu-io/my-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">Posts</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/friends/" class="nav-link">Friends</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Eng/中</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/posts/2018/use-firebase-cloud-function-to-count-website-visitors/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/posts/2018/use-firebase-cloud-function-to-count-website-visitors/" class="nav-link">中文</a></li></ul></div></div> <a href="https://github.com/tonyxu-io/my-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group first"><p class="sidebar-heading open"><span>Use Firebase Cloud Function to Count Website Visitors</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/posts/2018/use-firebase-cloud-function-to-count-website-visitors/#overview" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/2018/use-firebase-cloud-function-to-count-website-visitors/#deploy-static-page-to-firebase-cloud-hosting" class="sidebar-link">Deploy static page to Firebase Cloud Hosting</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/2018/use-firebase-cloud-function-to-count-website-visitors/#create-firebase-cloud-function" class="sidebar-link">Create Firebase Cloud Function</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/2018/use-firebase-cloud-function-to-count-website-visitors/#add-get-request-to-cloud-function-in-static-page" class="sidebar-link">Add Get request to Cloud Function in static page</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="use-firebase-cloud-function-to-count-website-visitors"><a href="#use-firebase-cloud-function-to-count-website-visitors" aria-hidden="true" class="header-anchor">#</a> Use Firebase Cloud Function to Count Website Visitors</h1> <p>It's getting popular to use Firebase hosting to host static website, however, you might not know you can still have server-side code hosted in Firebase for your static website, and that is the Firebase Cloud Function. Once of the case you might want to use the Cloud Function is to write something to Firebase database, for example, a hit counter. In this topic, I'll show you how to use Firebase Cloud Function and Firebase Realtime Database to count website visitor.</p> <h2 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h2> <p>Here are the steps we will be doing to build this feature:</p> <ol><li>Deploy static page to Firebase Cloud Hosting</li> <li>Create Firebase Cloud Function to update count number in Firebase Realtime Database</li> <li>Add Get request in static page to trigger Firebase Cloud Function</li></ol> <h2 id="deploy-static-page-to-firebase-cloud-hosting"><a href="#deploy-static-page-to-firebase-cloud-hosting" aria-hidden="true" class="header-anchor">#</a> Deploy static page to Firebase Cloud Hosting</h2> <p>Firebase Cloud Hosting is a great place to host your static pages. It's easier to setup than GitHub Pages, and you get a set of functionalities that designed for web developers. Once you have your static pages ready, do <code>firebase deploy</code> and it will be deployed to the cloud and accessible from anywhere.</p> <p>Refer to <a href="https://firebase.google.com/docs/hosting/quickstart" target="_blank" rel="noopener noreferrer">Quickstart<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> from documentation to get started with Firebase Cloud Hosting.</p> <h2 id="create-firebase-cloud-function"><a href="#create-firebase-cloud-function" aria-hidden="true" class="header-anchor">#</a> Create Firebase Cloud Function</h2> <p>Now, let's make use of Firebase Cloud Function to host some server-side logic to count website hit. In this piece of code, we will connect Cloud Function with Firebase Realtime Database so that the function can update hit counter stored in the database.</p> <ol><li>Initialize Cloud Function<div class="language-sh line-numbers-mode"><pre class="language-text"><code>firebase init functions
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>Create <code>hit_counter</code> node in Firebase Realtime Database and set value to 0<div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;hit_counter&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>Edit Cloud Function Code (<code>Index.js</code>)<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> functions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;firebase-functions&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> admin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;firebase-admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
admin<span class="token punctuation">.</span><span class="token function">initializeApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span>hitCounter <span class="token operator">=</span> functions<span class="token punctuation">.</span>https<span class="token punctuation">.</span><span class="token function">onRequest</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> counterRef <span class="token operator">=</span> admin<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;/hit_counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> counterRef
        <span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>current <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>current <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li>Deploy Cloud Function<div class="language-sh line-numbers-mode"><pre class="language-text"><code>firebase deploy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <p>Now you should have a Cloud Function URL which you can make a request to. Try access it in a browser and see if the counter number in Realtime Database get incremented by 1.</p> <h2 id="add-get-request-to-cloud-function-in-static-page"><a href="#add-get-request-to-cloud-function-in-static-page" aria-hidden="true" class="header-anchor">#</a> Add Get request to Cloud Function in static page</h2> <p>Now, in order to trigger the Cloud Function to update counter in Realtime Database, you need to make the static webpage to make a request to the Cloud Function.</p> <p>You can do it like below:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;//https://&lt;Region&gt;-&lt;YOUR-APP-ID&gt;.cloudfunctions.net/hitCounter&quot;</span><span class="token punctuation">)</span>
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This will fire a GET request to the Cloud Function endpoint, and trigger the Cloud Function code to update the counter number in Realtime Database.</p> <p>Congratulations, your static page now has server-side code that helps you track the hit count. The next step for you could be retrieve the counter in static page and display the count number.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/tonyxu-io/my-blog/edit/master/docs/posts/2018/use-firebase-cloud-function-to-count-website-visitors/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/25/2019, 1:56:26 AM</span></div></footer> <!----> <div class="comments"><div class="inner"><div id="disqus_thread"></div></div></div></main></div><div class="global-ui"><!----><div class="sticky-side-bar" data-v-46d9c502><a href="/tip/" data-v-46d9c502><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="dollar-sign" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 288 512" class="svg-inline--fa fa-dollar-sign fa-w-9" data-v-46d9c502 data-v-46d9c502><path fill="currentColor" d="M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z" data-v-46d9c502 data-v-46d9c502></path></svg></a> <!----></div></div></div>
    <script src="/assets/js/app.269ec5ce.js" defer></script><script src="/assets/js/12.5e9c564d.js" defer></script><script src="/assets/js/2.a93cbcc6.js" defer></script><script src="/assets/js/42.75a344de.js" defer></script><script src="/assets/js/13.0ba02817.js" defer></script>
  </body>
</html>
